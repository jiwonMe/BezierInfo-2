# 원과 2차 베지에 곡선

원과 베지에 곡선은 매우 다른 것들이며, 원은 베지에 곡선보다 작업하기 무한히 쉽습니다. 공식이 훨씬 간단하고 더 효율적으로 그릴 수 있습니다. 하지만 때로는 원, 타원, 호를 사용할 여유가 없습니다. 때로는 베지에 곡선만 있습니다. 예를 들어 폰트 디자인을 하는 경우, 폰트는 기하학적 형태의 개념이 없으며 직선과 베지에 곡선만 알고 있습니다. TrueType 외곽선이 있는 OpenType 폰트는 2차 베지에 곡선만 알고, Type 2 외곽선이 있는 OpenType 폰트는 3차 베지에 곡선만 압니다. 그렇다면 원, 타원, 호를 어떻게 그릴까요?

근사합니다.

베지에 곡선이 우리가 생각할 수 있는 모든 곡선을 모델링할 수 없다는 것을 이미 알고 있으며, 여기에는 완벽한 원과 타원, 그리고 그들의 호 대응물도 포함됩니다. 하지만 시각적으로 허용 가능한 정도로 확실히 근사할 수 있습니다. 2차 및 3차 곡선은 다른 곡률 제어를 제공하므로 원을 근사하기 위해 먼저 2차 및 3차 곡선으로 점점 더 큰 차수의 호를 근사하려고 할 때 오차가 무엇이고 좌표가 어디에 있는지 알아내야 합니다.

호는 중간점 대칭이므로 제어점이 대칭 곡선을 설정해야 합니다. 2차 곡선의 경우 제어점이 기준선과 직각으로 교차하는 선 어딘가에 있을 것입니다. 그리고 시작 및 끝 점에서 도함수가 정렬되어야 하므로 그것이 어디에 있을지 선택의 여지가 없습니다. 제어점은 시작 및 끝 점에서 접선의 교차점에 있을 것입니다.

먼저 2차 곡선을 원호에 맞춰봅시다. 다음 스케치에서 단위 원 위로 마우스를 움직여 2차 곡선이 (1,0)에서 마우스 커서가 있는 곳까지의 호를 얼마나 잘 또는 나쁘게 근사할 수 있는지 확인할 수 있습니다.

<graphics-element title="2차 베지에 호 근사" width="400" height="400" src="./arc-approximation.js">
  <input type="range" min="-3.1415" max="3.1415" step="0.01" value="-0.7854" class="slide-control">
</graphics-element>

보시다시피 상황이 꽤 빠르게 끔찍하게 잘못됩니다. 2차 곡선을 사용하여 4분원을 근사하려고 하는 것조차 나쁜 아이디어입니다. 8분원은 괜찮아 보일 수 있지만, 얼마나 괜찮은 것이 괜찮은 걸까요? 수학을 적용하고 알아봅시다. 우리가 관심 있는 것은 특정 시작 및 끝 각도가 주어졌을 때 곡선 위의 좌표가 원호와 비교하여 얼마나 벗어나 있는지입니다. 원호와 2차 곡선의 중간점 사이에 얼마나 많은 공간이 있는지 살펴보겠습니다.

시작점과 끝점으로 시작하고, 편의상 어떤 각도 *φ*에서 단위 원(0,0 주위의 반경 1인 원) 위에 놓겠습니다.

\[
  S = \begin{pmatrix} 1 \\ 0 \end{pmatrix} ~, ~\  E = \begin{pmatrix} cos(φ) \\ sin(φ) \end{pmatrix}
\]

찾고 싶은 것은 접선의 교차점이므로 다음과 같은 점 C를 원합니다.

\[
  C = S + a \cdot \begin{pmatrix} 0 \\ 1 \end{pmatrix} ~, ~\ C = E + b \cdot \begin{pmatrix} -sin(φ) \\ cos(φ) \end{pmatrix}
\]

즉, S를 통과하는 수직선(S에서 어떤 거리 *a*)에 있고 E를 통과하는 접선(E에서 어떤 거리 *b*)에도 있는 점을 원합니다. 이것을 풀면 다음을 얻습니다.

\[
  \left\{ \begin{array}{l}
    C_x = 1 = cos(φ) + b \cdot -sin(φ)\\
    C_y = a = sin(φ) + b \cdot cos(φ)
  \end{array} \right.
\]

먼저 *b*를 풉니다.

\[
  \begin{array}{l}
    1 = cos(φ) + b \cdot -sin(φ) ~→ \
    1 - cos(φ) = -b \cdot sin(φ) ~→ \
    -1 + cos(φ) = b \cdot sin(φ)
  \end{array}
\]

다음을 산출합니다.

\[
  b = \frac{cos(φ)-1}{sin(φ)}
\]

그런 다음 *a*에 대한 식에 대입할 수 있습니다.

\[
  \begin{aligned}
    a &= sin(φ) + b \cdot cos(φ) \\
    .. &= sin(φ) + \frac{-1 + cos(φ)}{sin(φ)} \cdot cos(φ) \\
    .. &= sin(φ) + \frac{-cos(φ) + cos^2(φ)}{sin(φ)} \\
    .. &= \frac{sin^2(φ) + cos^2(φ) - cos(φ)}{sin(φ)} \\
    a &= \frac{1 - cos(φ)}{sin(φ)}
  \end{aligned}
\]

빠른 확인을 통해 *a*와 *b*에 대한 이 값을 C<sub>x</sub> 및 C<sub>y</sub>에 대한 식에 대입하면 "A에서 *a* 떨어진" 것과 "B에서 *b* 떨어진" 것 모두에 대해 같은 x/y 좌표를 얻는다는 것을 알 수 있으므로 계속해봅시다. 이제 C에 대한 좌표 값을 알았으므로 베지에 다항식을 평가하기만 하면 되므로 *t=0.5*(또는 각도 φ/2)에 대한 곡선 위의 점 T가 어디에 있는지 알고, 각도 φ/2에 대한 원호의 실제 점 P가 어디에 있는지 압니다.

\[
  P_x = cos(\frac{φ}{2}) ~, ~\  P_y = sin(\frac{φ}{2})
\]

*t=0.5*이면 다항식 값 (1-t)², 2(1-t)t, t²가 각각 0.25, 0.5, 0.25라는 것을 관찰하면서 T를 계산합니다.

\[
  T = \frac{1}{4}S + \frac{2}{4}C + \frac{1}{4}E = \frac{1}{4}(S + 2C + E)
\]

x 및 y 성분에 대해 계산하면 다음을 얻습니다.

\[
  \begin{array}{l}
    \left\{\begin{aligned}
    T_x &= \frac{1}{4}(3 + cos(φ))\\
    T_y &= \frac{1}{4}\left(\frac{2-2cos(φ)}{sin(φ)} + sin(φ)\right)
         = \frac{1}{4}\left(2tan\left(\frac{φ}{2}\right) + sin(φ)\right)
    \end{aligned}\right.
  \end{array}
\]

그리고 이 둘 사이의 거리는 표준 유클리드 거리입니다.

\[
  \begin{aligned}
    d_x(φ) &= T_x - P_x = \frac{1}{4}(3 + cos(φ)) - cos(\frac{φ}{2}) = 2sin^4\left(\frac{φ}{4}\right) ~, \\
    d_y(φ) &= T_y - P_y = \frac{1}{4}\left(2tan\left(\frac{φ}{2}\right) + sin(φ)\right) - sin(\frac{φ}{2}) ~, \\
    &⇓\\
    d(φ) &= \sqrt{d^2_x + d^2_y} = ~... ~ = 2sin^4(\frac{φ}{4})\sqrt{\frac{1}{cos^2(\frac{φ}{2})}}
  \end{aligned}
\]

그렇다면 반원, 4분원, 8분원 같은 각도 φ의 여러 범위에 대해 플롯할 때 이 거리 함수는 어떻게 생겼을까요?

<table><tbody><tr><td>
  <img src="images/arc-q-pi.gif" height="190"/>
  0 ≤ φ ≤ π에 대해 플롯:
</td><td>
  <img src="images/arc-q-pi2.gif" height="187"/>
  0 ≤ φ ≤ ½π에 대해 플롯:
</td><td>
  <a href="https://www.wolframalpha.com/input/?i=plot+sqrt%28%281%2F4+*+%28sin%28x%29+%2B+2tan%28x%2F2%29%29+-+sin%28x%2F2%29%29%5E2+%2B+%282sin%5E4%28x%2F4%29%29%5E2%29+for+0+%3C%3D+x+%3C%3D+pi%2F4">
    <img src="images/arc-q-pi4.gif" height="174"/>
  </a>
  0 ≤ φ ≤ ¼π에 대해 플롯:
</td></tr></tbody></table>

이제 8분원 호는 괜찮아 보이지만 4분원 호는 그렇지 않은 이유를 알 수 있습니다. *t=0.5*에서 대략 0.06의 오차는 6% 벗어났다는 것을 의미합니다... 픽셀 반경 17의 원에서 이미 1픽셀 벗어날 것입니다. 예를 들어 반경이 100px인 괜찮은 크기의 4분원 호는 2차 곡선으로 근사하면 엄청나게 벗어날 것입니다! 그러나 8분원 호의 경우 오차는 대략 0.003 또는 0.3%에 불과하며, 이것이 실제 8분원 호에 매우 가깝게 보이는 이유를 설명합니다. 사실 0.001 같은 정말 작은 오차를 원한다면 (반올림) 0.593667의 각도를 견뎌야 하며, 이는 대략 34도에 해당합니다. 그 정밀도로 완전한 원을 형성하려면 11개의 2차 곡선이 필요합니다! (기술적으로는 10과 17분의 10이지만 부분 곡선은 할 수 없으므로 반올림해야 합니다). 간단한 함수를 사용하여 그릴 수 있는 형태를 얻기 위해 많은 곡선이 필요합니다!

사실 함수를 뒤집어서 정밀도 오차 ε를 대입하면 그 정밀도에 대한 최대 각도를 얻도록 해봅시다.

\[
  φ = 4 \cdot arccos \left(\frac{\sqrt{2+ε-\sqrt{ε(2+ε)}}}{\sqrt{2}}\right)
\]

솔직히 이 시점에서 상황이 약간 우스꽝스러워 보이기 시작합니다. 지금까지 한 것보다 훨씬 더 많은 수학을 하고 있지만, 다행히도 이것이 수학이 우리를 데려가야 하는 만큼입니다. 정밀도 0.1, 0.01, 0.001, 0.0001을 대입하면 라디안 값 1.748, 1.038, 0.594, 0.3356을 얻습니다. 도 단위로 말하면 대략 100도(4개의 곡선 필요), 59.5도(6개의 곡선 필요), 34도(11개의 곡선 필요), 19.2도(무려 19개의 곡선 필요)를 커버할 수 있다는 의미입니다.

결론? 원형(또는 한 차원에서 압착된 원인 타원형) 곡선을 원한다면 **2차 곡선은 다소 형편없습니다**. 곡선의 차수를 한 번만 올리더라도 더 잘할 수 있습니다. 그럼 3차 곡선에 대해 같은 것을 시도해봅시다.
