# 이 섹션은 실제로 유용한 것을 가르치지 않으므로 현재 메인 문서의 일부가 아닙니다.

# 불린 형태 연산

이 입문서에서 지금까지 다룬 주제를 적용하여 베지에 곡선을 포함하는 두 개 이상의 형태 사이의 합집합, 교집합 또는 배제를 얻는 불린 형태 연산을 수행할 수 있습니다. 단순성을 위해(글쎄... 일종의, 더 동질성을 위해), 다중 베지에 형태만 살펴보겠지만, 선과 베지에 곡선의 혼합으로 구성된 형태는 기술적으로 단순화입니다. (물론 선과 베지에 곡선을 혼합하는 형태 클래스에 대한 정의를 작성해야 합니다. 다중 베지에 곡선이 상위 집합이므로 다음 예제에서는 이것을 사용하겠습니다.)

불린 연산을 수행하는 절차는 대략적으로 네 단계로 구성됩니다.

1. 두 형태 사이의 교차점 찾기,
2. 이러한 교차점 사이의 여러 섹션으로 형태 자르기,
3. 원하는 연산의 결과 형태의 일부가 아닌 섹션 폐기, 그리고
4. 남은 섹션을 연결하여 새 형태 형성.

두 다중 베지에 곡선 사이 또는 다중 선 섹션 형태 사이의 모든 교차점을 찾는 것은 곡선/곡선 교차 섹션에서 논의한 반복 알고리즘과 유사합니다. 다중 베지에 곡선의 각 세그먼트에 대해 바운딩 박스가 다른 다중 베지에 곡선의 세그먼트 바운딩 박스와 겹치는지 확인합니다. 그렇다면 일반 교차점 감지를 실행합니다.

모든 교차점을 찾은 후 다중 베지에 곡선을 분할하고, 새로 형성된 다중 베지에 곡선 중 원본을 분할한 지점에서 잠재적으로 연결될 수 있는 곡선을 기록해야 합니다. 이를 통해 다음 단계 후 다중 베지에 곡선을 빠르게 다시 접착할 수 있습니다.

모든 새 다중 베지에 곡선이 있으면 원하는 불린 연산의 첫 번째 단계를 실행합니다.

- 합집합: 형태의 합집합 "내부"에 있는 모든 다중 베지에 곡선을 폐기합니다. 예를 들어 겹치는 두 원의 합집합을 원하면 결과 형태는 외곽선입니다.
- 교집합: 두 형태의 교집합 "외부"에 있는 모든 다중 베지에 곡선을 폐기합니다. 예를 들어 겹치는 두 원의 교집합을 원하면 결과 형태는 겹치는 테이퍼 타원입니다.
- 배제: 섹션이 폐기되지 않지만 특별한 방식으로 형태를 다시 연결해야 합니다. "합집합" 규칙에 따라 제거 대상이 되는 섹션을 뒤집습니다.

<div class="grid">
  <figure>
    <img src="images/op_base.gif" height="169"/>
    <figcaption>겹치는 두 형태</figcaption>
  </figure>
  <figure class="labeled-image">
    <img src="images/op_union.gif" height="169"/>
    <figcaption>합집합</figcaption>
  </figure>
  <figure class="labeled-image">
    <img src="images/op_intersection.gif" height="169"/>
    <figcaption>교집합</figcaption>
  </figure>
  <figure class="labeled-image">
    <img src="images/op_exclusion.gif" height="169"/>
    <figcaption>배제 (합집합 빼기 교집합)</figcaption>
  </figure>
</div>

여기에 설명된 절차의 주요 복잡성은 섹션이 형태의 "내부"와 "외부"에 있는 것으로 어떻게 판단되는지 결정하는 것입니다. 이를 위해 점-형태 내부 감지를 수행할 수 있어야 하며, 이를 위해 고전적인 알고리즘을 사용합니다. 광선 투사를 사용하여 "교차 번호"를 얻은 다음 [짝수-홀수 규칙](https://folk.uio.no/bjornw/doc/bifrost-ref/bifrost-ref-12.html)을 적용하여 "내부성"을 테스트합니다. 모든 점과 모든 형태에 대해 점에서 형태 외부에 있다고 알고 있는 어떤 점(예: 그리기 표면의 모서리)까지 광선을 투사할 수 있습니다. 그런 다음 그 선이 형태를 몇 번 교차하는지 셉니다(선/곡선 교차 감지는 꽤 쉽게 수행할 수 있습니다). 형태 외곽선과 교차하는 횟수가 짝수이면 점이 실제로 형태 내부에 있지 않은 것입니다. 교차 횟수가 홀수이면 점이 형태 내부에 있는 것입니다. 이 지식을 통해 그러한 점이 있는 섹션을 "제거 필요"(합집합 규칙에 따라), "보존 필요"(교집합 규칙에 따라) 또는 "뒤집기 필요"(배제 규칙에 따라)로 처리할지 결정할 수 있습니다.

이러한 연산은 비용이 많이 들고, 선택한 언어에 대해 이미 사용 가능한 기하학 패키지가 있다면 자체 코드를 구현하는 것은 일반적으로 나쁜 생각입니다. 이 경우 JavaScript의 경우 가장 훌륭한 [Paper.js](https://paperjs.org)에는 이미 효율적인 불린 형태 연산을 수행하는 모든 코드가 있으므로, 여기에서 열등한 버전을 구현하는 대신 불린 형태 작업을 할 의도라면 Paper.js 라이브러리를 강력히 추천할 수 있습니다.

(물론 일반 기하학 라이브러리로서 Paper.js는 이 전체 입문서의 크기와 거의 같으므로, 설명 목적으로 다음 그래픽은 자체 불린 연산을 구현하며 모든 엣지 케이스에서 완전히 올바른 작업을 수행하지 않을 수 있습니다!)

<graphics-element title="불린 형태 연산" src="./boolean.js"></graphics-element>
