# 점을 베지에 곡선에 투영하기

실제 곡선 성형으로 넘어가기 전에, 클릭하려는 "곡선 위의 어떤 점"을 실제로 찾을 수 있는 방법을 아는 것이 좋습니다. 결국 베지에 좌표만 있다면 커서가 곡선의 어느 점에 가장 가까울지 알아내기에는 그 자체로 충분하지 않습니다. 그렇다면 점을 곡선에 어떻게 투영할까요?

베지에 곡선의 차수가 충분히 낮다면 [이를 수행하는 방법에 대한 수학을 계산](https://web.archive.org/web/20140713004709/http://jazzros.blogspot.com/2011/03/projecting-point-on-bezier-curve.html)하여 완벽한 `t` 값을 얻을 수 있지만, 일반적으로 이것은 엄청나게 어려운 문제이며 가장 쉬운 해결책은 정말로 다시 수치적 접근입니다. [이진 검색](https://en.wikipedia.org/wiki/Binary_search_algorithm)을 사용하여 이상적인 `t` 값을 찾을 것입니다. 먼저 곡선의 "그리기" 좌표와 연관된 `t` 값을 기반으로 대략적인 거리 검사를 수행합니다(조회 테이블 또는 LUT 사용). 이것은 꽤 빠릅니다.

```
p = 곡선에 투영할 어떤 점
d = 처음에 매우 큰 값
i = 0
for (coordinate, index) in LUT:
  q = distance(coordinate, p)
  if q < d:
    d = q
    i = index
```

이것이 실행된 후, `LUT[i]`가 투영하려는 점에 가장 가까운 곡선 위의 좌표(_LUT 내에서_)라는 것을 알게 되므로, 곡선에 대한 최상의 투영이 무엇인지에 대한 꽤 좋은 초기 추측입니다. 이를 정제하기 위해 `LUT[i]`가 `LUT[i-1]`과 `LUT[i+1]` 모두보다 더 나은 추측이지만, 이 두 값 사이 _어딘가 다른 곳에_ 더 나은 투영이 있을 수 있다는 점에 주목합니다. 그래서 이진 검색의 변형을 사용하여 이것을 테스트할 것입니다.

1. 점 `p`와 구간 `v = t2-t1`을 걸쳐있는 `t` 값 `t1=LUT[i-1].t`와 `t2=LUT[i+1].t`로 시작합니다.
2. 이 구간을 다섯 지점에서 테스트합니다: 시작, 중간, 끝(이미 가지고 있음)과 중간과 시작/끝 점 사이의 두 점
3. 그런 다음 이 다섯 점 중 어느 것이 원래 점 `p`에 가장 가까운지 확인하고, 방금 찾은 가장 가까운 점 전후의 점으로 1단계를 반복합니다.

이렇게 하면 각 반복마다 확인하는 구간이 점점 작아지며, 구간이 너무 작아져서 모든 점에 대해 사실상 같은 거리가 될 때까지 세 단계를 계속 실행할 수 있습니다.

그럼 실제로 봅시다. 이 경우 구간이 0.001보다 작아질 때까지 루프를 실행하고, 마우스 커서나 손가락 끝을 다소 복잡한 베지에 곡선에 투영하는 것이 무엇을 의미하는지 보여드리겠습니다(물론 원하는 대로 곡선을 재구성할 수 있습니다). 대략적인 검사가 찾는 원래 세 점도 함께 표시됩니다.

<graphics-element title="점을 베지에 곡선에 투영하기" width="400" height="400" src="./project.js"></graphics-element>
