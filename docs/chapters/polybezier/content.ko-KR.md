# 다중 베지에 곡선 형성하기

선을 연결하여 다각형을 형성할 수 있는 것처럼, 베지에 곡선을 연결하여 다중 베지에를 형성할 수 있으며, 필요한 트릭은 다음을 확인하는 것뿐입니다.

1. 각 섹션의 끝점이 다음 섹션의 시작점이고,
2. 그 이중 점을 가로지르는 도함수가 정렬됩니다.

물론 날카로운 모서리를 원하지 않는 한 말입니다. 그렇다면 2번도 필요 없습니다.

이 섹션에서는 세 가지 형태의 다중 베지에 곡선을 다루겠습니다. 먼저 세그먼트의 끝점이 다음 세그먼트의 시작점과 같은 점인 1번만 따르는 종류를 살펴보겠습니다. 이것은 작업하기 꽤 어려운 다중 베지에가 되지만 구현하기는 가장 쉽습니다.

<graphics-element title="연결되지 않은 2차 다중 베지에" src="./poly.js" data-type="quadratic" data-link="coordinate"></graphics-element>
<graphics-element title="연결되지 않은 3차 다중 베지에" src="./poly.js" data-type="cubic" data-link="coordinate"></graphics-element>

제어점을 끌면 제어점이 속한 곡선 세그먼트에만 영향을 미치고, 곡선 위의 점을 움직이면 제어점이 있던 곳에 그대로 남아서 실용적인 모델링 목적으로는 가장 유용하지 않습니다. 그래서 좀 더 나아지기 위해 필요한 로직을 추가해봅시다. 곡선 위의 점에서 "들어오는" 도함수가 "나가는" 도함수와 같도록 하여 제어점을 연결하는 것부터 시작하겠습니다.

\[
  B'(1)_n = B'(0)_{n+1}
\]

곡선의 마지막 제어점에서 마지막 곡선 위의 점까지의 벡터가 도함수 벡터와 같다는 것을 알고 있으므로 이것을 꽤 쉽게 적용할 수 있습니다. 다음 곡선의 첫 번째 제어점이 일치하도록 하려면 마지막 제어점을 마지막 곡선 위의 점을 통해 미러링하기만 하면 됩니다. 그리고 어떤 점 A를 어떤 점 B를 통해 미러링하는 것은 정말 간단합니다.

\[
  \textit{Mirrored} = \left [
    \begin{matrix} B_x + (B_x - A_x) \\  B_y + (B_y - A_y) \end{matrix}
  \right ] = \left [
    \begin{matrix} 2B_x - A_x \\  2B_y - A_y \end{matrix}
  \right ]
\]

그럼 이것을 구현하고 무엇을 얻는지 봅시다. 다음 두 그래픽은 2차 및 3차 다중 베지에 곡선을 다시 보여주지만, 이번에는 제어점을 움직이면 다른 것들도 움직입니다. 하지만 2차 곡선에서 예상치 못한 일이 일어나는 것을 볼 수 있습니다...

<graphics-element title="연결된 2차 다중 베지에" src="./poly.js" data-type="quadratic" data-link="derivative"></graphics-element>
<graphics-element title="연결된 3차 다중 베지에" src="./poly.js" data-type="cubic" data-link="derivative"></graphics-element>

보시다시피 2차 곡선은 다중 베지에 곡선에 특히 적합하지 않습니다. 모든 제어점이 효과적으로 연결되어 있습니다. 하나를 움직이면 모두 움직입니다. 뿐만 아니라 곡선 위의 점을 움직이면 제어점이 두 이웃 제어점의 반사라는 제약을 만족할 수 없는 상황이 발생할 수 있습니다... 이것은 정말, 정말 간단한 형태 이외에는 2차 다중 베지에를 사용할 수 없다는 것을 의미합니다. 그리고 그때도 아마 잘못된 선택일 것입니다. 3차 곡선은 꽤 괜찮지만 도함수가 연결되어 있다는 사실은 제약을 조금 완화하면 할 수 있는 것만큼 잘 곡선을 조작할 수 없다는 것을 의미합니다.

그래서: 요구 사항을 조금 완화해봅시다.

여전히 섹션 간 도함수의 *각도*를 보존하도록(따라서 한 섹션에서 다음 섹션으로의 전환이 여전히 자연스럽게 보이도록) 제약을 변경할 수 있지만, 같은 *벡터 길이*를 가져야 한다는 요구 사항을 포기할 수 있습니다. 그렇게 하면 훨씬 더 유용한 종류의 다중 베지에 곡선을 얻을 수 있습니다.

<graphics-element title="각도로 연결된 2차 다중 베지에" src="./poly.js" data-type="quadratic" data-link="direction"></graphics-element>
<graphics-element title="각도로 연결된 3차 다중 베지에" src="./poly.js" data-type="cubic" data-link="direction"></graphics-element>

3차 곡선은 이제 제어점을 끌 때 더 잘 작동하지만, 2차 다중 베지에는 여전히 하나의 제어점을 움직이면 제어점이 움직이고 "다음" 제어점을 작동하지 않는 방식으로 정의하게 될 수 있다는 문제가 있습니다. 2차 곡선은 정말로 작업하기에 그다지 유용하지 않습니다...

마지막으로 곡선 위의 좌표를 움직이는 것이 관련 제어점의 상대 위치를 보존하도록 해야 합니다. 그렇게 하면 Photoshop, Inkscape, Blender 등의 애플리케이션에서 익숙할 수 있는 곡선 제어 유형을 얻을 수 있습니다.

<graphics-element title="표준 연결된 2차 다중 베지에" src="./poly.js" data-type="quadratic" data-link="conventional"></graphics-element>
<graphics-element title="표준 연결된 3차 다중 베지에" src="./poly.js" data-type="cubic"  data-link="conventional"></graphics-element>

다시 말하지만, 3차 곡선은 이제 작업하기에 꽤 멋지지만 2차 곡선에는 새롭고 매우 심각한 문제가 있습니다. 곡선 위의 점을 "다음에 무엇이 일어나야" 하는지 계산할 수 없는 방식으로 이동할 수 있습니다. 예를 들어 위쪽 점을 아래로, 왼쪽 및 오른쪽 점 아래로 이동해보세요. 아래쪽 점에 꺾임 없이 올바른 제어점을 보존할 방법이 없습니다. 2차 곡선: 그냥 그렇게 좋지 않습니다...

마지막 개선은 어떤 점이 어떻게 작동하는지에 대한 세밀한 제어를 제공하여 필요할 때 "꺾임" 또는 개별적으로 제어되는 세그먼트를 가질 수 있고, 나머지 경로에 대해서는 멋지게 잘 작동하는 곡선을 가질 수 있도록 하는 것입니다. 그것을 구현하는 것은 독자를 위한 연습으로 남겨둡니다.
