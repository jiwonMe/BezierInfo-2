# 곡선 변곡점

이제 곡선을 정렬하는 방법을 알았으니, 계산할 수 있는 한 가지가 더 있습니다. 바로 변곡점입니다. 곡선에 대고 밀어 넣을 수 있는 가변 크기 원이 있다고 상상해봅시다. 원을 곡선에 대고 놓고 원이 곡선과 닿는 곳에서 곡선과 원의 곡률이 같도록 반경을 조정한 다음 곡선을 따라 원을 밀기 시작합니다. 2차 곡선의 경우 원이 이상하게 작동하지 않고 항상 이렇게 할 수 있습니다. 곡선을 따라 밀면서 원의 반경을 변경해야 할 수도 있지만 항상 곡선의 같은 쪽에 붙어 있습니다.

그런데 3차 곡선에서는 어떻게 될까요? S 곡선이 있고 곡선의 시작 부분에 원을 놓고 밀기 시작한다고 상상해봅시다. 잠시 동안은 반경을 조정하면 괜찮지만, S의 중간점에 도달하면 이상한 일이 발생합니다. 곡률이 계속 일치하도록 하기 위해 원이 곡선의 한쪽에서 다른 쪽으로 "뒤집힙니다". 이것을 변곡이라고 하며, 그것이 어디서 일어나는지 비교적 쉽게 찾을 수 있습니다.

해야 할 일은 간단한 방정식을 푸는 것입니다.

\[
  C(t) = 0
\]

여기서 말하는 것은 곡률 함수 *C(t)*가 주어졌을 때, 이 함수가 0인 *t* 값을 알고 싶다는 것입니다. 즉, "곡률"이 없으며, 이것은 원이 곡선의 한쪽에 있는 것과 다른 쪽에 있는 것 사이의 점에서 정확히 나타납니다. 그렇다면 *C(t)*는 어떻게 생겼을까요? 실제로는 그다지 어렵지 않아 보입니다.

\[
  C(t) = \textit{Bézier}_x\prime(t) \cdot \textit{Bézier}_y{\prime\prime}(t) - \textit{Bézier}_y\prime(t) \cdot \textit{Bézier}_x{\prime\prime}(t)
\]

함수 *C(t)*는 곡선의 매개변수 차원에 대한 1차 및 2차 도함수 함수 사이의 외적입니다. 그리고 이미 보여드렸듯이, 베지에 곡선의 도함수는 계산하기 매우 쉬운 새 계수를 가진 더 간단한 베지에 곡선일 뿐이므로 이것은 꽤 쉬울 것입니다.

그러나 정렬 섹션에서 본 것처럼, 정렬을 통해 대부분의 수학적 평가에서 첫 번째 좌표의 기여를 완전히 제거하고 마지막 점이 x축에 놓이므로 마지막 *y* 좌표도 제거하여 작업을 *많이* 단순화할 수 있습니다. 따라서 곡선에 대해 *C(t) = 0*을 평가할 수 있지만, 먼저 곡선을 축 정렬한 *다음* 곡률 함수를 평가하는 것이 훨씬 쉬울 것입니다.

<div class="note">

### 전체 공식을 어쨌든 도출해봅시다

물론 정렬된 검사를 수행하기 전에 축 정렬 없이 곡률 함수를 계산하면 어떻게 되는지 봅시다. 기저 함수를 사용하여 1차 및 2차 도함수부터 시작합니다.

\[
\begin{aligned}
  & \textit{Bézier}(t) = x_1(1-t)^3 + 3x_2(1-t)^2t + 3x_3(1-t)t^2 + x_4t^3 \\
  & \textit{Bézier}^\prime(t) = a(1-t)^2 + 2b(1-t)t + ct^2~ \left\{ a=3(x_2-x_1),b=3(x_3-x_2),c=3(x_4-x_3) \right\} \\
  & \textit{Bézier}^{\prime\prime}(t) = u(1-t) + vt~\left\{ u=2(b-a),v=2(c-b) \right\}\
\end{aligned}
\]

물론 *y*에 대해서도 같은 함수입니다.

\[
\begin{aligned}
  & \textit{Bézier}(t) = y_1(1-t)^3 + 3y_2(1-t)^2t + 3y_3(1-t)t^2 + y_4t^3 \\
  & \textit{Bézier}^\prime(t) = d(1-t)^2 + 2e(1-t)t + ft^2\\
  & \textit{Bézier}^{\prime\prime}(t) = w(1-t) + zt
\end{aligned}
\]

이제 컴퓨터에게 *C(t)* 함수를 구성하고(읽기 쉬운 간단한 항 형태로 전개하도록) 요청하면 다소 지나치게 복잡한 산술 표현식 집합을 얻습니다.

\[
\begin{array}{lclclclclcl}
-18 t^2 x_2 y_1 &+& 36 t^2 x_3 y_1 &-& 18 t^2 x_4 y_1 &+& 18 t^2 x_1 y_2 &-& 54 t^2 x_3 y_2 &&\\
+36 t^2 x_4 y_2 &-& 36 t^2 x_1 y_3 &+& 54 t^2 x_2 y_3 &-& 18 t^2 x_4 y_3 &+& 18 t^2 x_1 y_4 &&\\
-36 t^2 x_2 y_4 &+& 18 t^2 x_3 y_4 &+& 36 t x_2 y_1   &-& 54 t x_3 y_1   &+& 18 t x_4 y_1 &-& 36 t x_1 y_2 \\
+54 t x_3 y_2   &-& 18 t x_4 y_2   &+& 54 t x_1 y_3   &-& 54 t x_2 y_3   &-& 18 t x_1 y_4 &+& 18 t x_2 y_4 \\
-18 x_2 y_1     &+& 18 x_3 y_1     &+& 18 x_1 y_2     &-& 18 x_3 y_2     &-& 18 x_1 y_3   &+& 18 x_2 y_3
\end{array}
\]

다루기 어렵습니다. 따라서 x1, y1, y4와 관련된 곱셈을 포함하는 항이 많다는 것을 알 수 있으며, 곡선을 축 정렬하면 모두 사라질 것이므로 정렬이 좋은 아이디어입니다.

</div>

8개 계수 중 3개가 0이 되도록 곡선을 정렬하고, 스케일이 `t` 값 찾기에 영향을 미치지 않는다는 것을 관찰하면 다음과 같은 *C(t)*에 대한 간단한 항 함수가 나옵니다.

\[
  \left ( 3 x_3 y_2+2 x_4 y_2+3 x_2 y_3-x_4 y_3 \right ) t^2 + \left ( 3 x_3 y_2-x_4 y_2-3 x_2 y_3 \right ) t + \left ( x_2 y_3-x_3 y_2 \right )
\]

작업하기 훨씬 쉽습니다. 계산한 다음 캐시할 수 있는 항이 상당히 많이 보이므로 다음과 같이 단순화됩니다.

\[
  \left.\begin{matrix}
    a = x_3 \cdot y_2 \\
    b = x_4 \cdot y_2 \\
    c = x_2 \cdot y_3 \\
    d = x_4 \cdot y_3
  \end{matrix}\right\}
  ~C(t) = (-3a + 2b + 3c - d)t^2 + (3a - b - 3c)t + (c - a)
\]

이것은 일반적인 2차 곡선이며 *C(t) = 0*을 푸는 방법을 알고 있습니다. 2차 공식을 사용합니다.

\[
  \left.\begin{matrix}
    x =& -3a + 2b + 3c - d \\
    y =& 3a - b - 3c \\
    z =& c - a
  \end{matrix}\right\}
  ~C(t) = 0 ~\Rightarrow~t = \frac{-y \pm \sqrt{y^2 - 4 x z}}{2x}
\]

판별식이 음수가 아닌 *경우*(실근만 원하고 복소근은 원하지 않기 때문에), 그리고 *x*가 0이 아닌 *경우*(0으로 나누기는 상당히 쓸모 없기 때문에) 이 값을 쉽게 계산할 수 있습니다.

이를 고려하여 *t*를 계산하고, 베지에 구간 [0,1]에 없는 *t* 값은 무시하면, 이제 곡선이 변곡할 *t* 값을 알게 됩니다.

<graphics-element title="3차 베지에 곡선 변곡점 찾기" src="./inflection.js"></graphics-element>
